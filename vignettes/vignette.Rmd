---
title: "covid19Visualizer"
author: "Adrian Joseph"
output: html_document
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library('ff')
library('covid19Visualizer')
library('kableExtra')
library('DBI')
library('here')
```

# Introduction

Simple data visualizer for COVID-19 diffusion.

## Data

### Database

Data is provided by `Our world in data` and is obtained from <https://covid.ourworldindata.org/data/owid-covid-data.xlsx>.

New data is obtained with `updateDb()` (a network connection is required).

We can explore the database using the `rsqlite`/`DBI` package'

```{r exploreDb, warning=FALSE}
# connec to the database
con <- dbConnect(RSQLite::SQLite(), "testdb")

# get tables
dbListTables(con)

# get fields in a table
dbListFields(con, "events")

# close database connection
dbDisconnect(con)
```

### Population data

We can obtain country social-demographic information, such us population, average age, GDP etc.

```{r population, warning=FALSE}
population <- getPopulationDb(c('Canada', 'Italy'))
```

### Events data

We can obtain country-wise COVID metrics such as cases, vaccinations, testing, etc.

```{r events, warning=FALSE}
events <- getEventsDb(c('Canada', 'Italy'),
                      c('total_cases',
                        'total_vaccinations'))
```

## Plots and tables

### Plot events

Plot normalising the data by country population. Plot will be number of cases and vaccaination every 100 inhabitants.

```{r plotEvents, warning=FALSE}
p <- eventsPlot(events, population, 'population', 100)
p
#ggplotly(p, tooltip = 'text')
```

### Plot population

This plot does not have y axis because metrics are normalised between 0 and 1 so that they can be visualised even when massively different (i.e. population and age). 
It is advised to display the plot using plotly: `ggplotly(p, tooltip = 'text')` to get more information from the tooltip.

```{r plotPopulation, warning=FALSE}
p <- populationPlot(population,
                    c('aged_65_older',
                      'aged_70_older',
                      'population'))
p
#ggplotly(p, tooltip = 'text')
```

### Population data

```{r populationData, warning=FALSE}
df <- populationForDisplay(population)
kableExtra::kable(df)
```

## Maps

```{r maps, warning=FALSE}
countries <- NULL#c('Canada', 'Italy')
normBy <- 'population'
metric <- 'total_cases'
events <- getEventsMapDb(countries,
                         metric,
                         date = '2021-01-31',
                         normBy,
                         multiplyFactor =  100)
doMap(events, FALSE)

countries <- c('Canada', 'Italy')
normBy <- NULL
metric <- 'total_cases'
events <- getEventsMapDb(countries,
                         metric,
                         date = '2021-01-31',
                         normBy,
                         multiplyFactor =  100)
doMap(events, TRUE)

```

Last update `r Sys.Date()`.
